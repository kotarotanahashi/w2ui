/* kicstart 0.x (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var app=function(app){function header(e){$("#app-header").html(e)}function timer(){timer_start=(new Date).getTime(),timer_lap=(new Date).getTime(),console.log("Start Timer")}function lap(e){typeof e!="string"?e="":e=' "'+e+'"',console.log("Total:",(new Date).getTime()-timer_start,"Lap"+e+":",(new Date).getTime()-timer_lap),timer_lap=(new Date).getTime()}function register(e,t){if(!app.modules.hasOwnProperty(e))return console.log("ERROR: Module "+e+" is not defined. You need to define the module in /app/conf/modules.js"),!1;if(app.hasOwnProperty(e)&&app[e].render=="function")return console.log("ERROR: Module "+e+" is already registered."),!1;app.get(app.modules[e].assets,function(n){var r=app[e].callBack;app[e]=t(n,app[e].params),r()})}function load(e,t,n){function o(){typeof n=="function"&&r==0&&n(!0)}$.isArray(e)||(e=[e]),typeof t=="function"&&(n=t,t={}),t||(t={});var r=e.length;for(var i in e){var s=e[i];if(typeof app.modules[s]=="undefined"){r--,console.log('ERROR: module "'+s+'" is not defined. Define it in app/conf/modules.js.');return}app[s]=app[s]||{},app[s].params=$.extend({},t),app[s].callBack=n,app.modules[s]&&app.modules[s].isLoaded===!0?(r--,typeof app[s].render=="undefined"?console.log('ERROR: Loader: module "'+s+'" has no render() method.'):(app[s].render(),o())):$.ajax({url:app.modules[s].url,dataType:"script"}).always(function(){r--}).done(function(e,t,n){app.modules[s].isLoaded=!0,o()}).fail(function(e,t,n){t=="error"?console.log('ERROR: Loader: module "'+s+'" failed to load ('+app.modules[s].url+")."):(console.log('ERROR: Loader: module "'+s+'" is loaded ('+app.modules[s].url+"), but with a parsing error(s) in line "+n.line+": "+n.message),app.modules[s].isLoaded=!0,o())})}}function get(e,t){function s(){r--,r<=0&&t(n)}var n={},r=e.length;for(var i in e)(function(){var t=i,r=e[i];$.ajax({url:r,dataType:"text",success:function(e,i,o){if(i!="success"){console.log("ERROR: Loader: error while getting a file "+r+".");return}n[t]=o.responseText,s()},error:function(r,o,u){o=="error"?console.log("ERROR: Loader: failed to load "+e[i]+"."):(console.log('ERROR: Loader: file "'+e[i]+'" is loaded, but with a parsing error(s) in line '+u.line+": "+u.message),n[t]=responseObj.responseText,s())}})})()}function include(e){typeof e=="string"&&(e=[e]);for(var t in e)$(document).append('<script type="text/javascript" src="'+e[t]+'"></script>')}function init(){app.get(["app/conf/session.js"],function(data){try{for(var i in data)eval(data[i])}catch(e){}if(document.location.href.indexOf("login.html")>0)return;app.user=app.session();if($.isEmptyObject(app.user)){document.location="login.html";return}var files=["app/conf/action.js","app/conf/modules.js","app/conf/config.js","app/conf/start.js"];app.get(files,function(data){try{for(var i in data)eval(data[i])}catch(e){app.include(files)}$("#app-toolbar").w2toolbar(app.config.app_toolbar),$("#app-tabs").w2tabs(app.config.app_tabs),$("#app-main").w2layout(app.config.app_layout),setTimeout(function(){$("#app-container").fadeIn(200),setTimeout(function(){var e=0;app.config.show.toolbar?($("#app-toolbar").css("height","30px").show(),e+=30):$("#app-toolbar").hide(),app.config.show.tabs?($("#app-tabs").css({top:e+"px",height:"30px"}).show(),e+=30):$("#app-tabs").hide(),$("#app-top").css("height",e+"px").show(),app.config.show.header?($("#app-header").css({top:e+"px",height:"60px"}).show(),e+=60):$("#app-header").hide(),$("#app-main").css("top",e+"px"),typeof app.start=="function"&&app.start()},200)},100)})})}var timer_start,timer_lap;return app.user={},app.config={},app.modules={},app.header=header,app.timer=timer,app.lap=lap,app.register=register,app.load=load,app.get=get,app.include=include,app.action=null,app.start=null,app.session=null,app.login=null,app.logout=null,app.forgot=null,init(),app}(app||{});
